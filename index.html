<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Sliderler (mqtt.js)</title>
</head>
<body>
    <h1>MQTT Sliderler (mqtt.js)</h1>
    
    <label for="slider1">Ön Bahçe 1 Süre:</label>
    <input type="range" id="slider1" min="0" max="100" value="50" class="slider">
    <span id="slider1Value">50</span><br><br>

    <label for="slider2">Ön Bahçe 2 Süre:</label>
    <input type="range" id="slider2" min="0" max="100" value="50" class="slider">
    <span id="slider2Value">50</span><br><br>

    <label for="slider3">Arka Bahçe 1 Süre:</label>
    <input type="range" id="slider3" min="0" max="100" value="50" class="slider">
    <span id="slider3Value">50</span><br><br>

    <label for="slider4">Arka Bahçe 2 Süre:</label>
    <input type="range" id="slider4" min="0" max="100" value="50" class="slider">
    <span id="slider4Value">50</span><br><br>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.2.7/mqtt.min.js"></script>
    <script>
        // MQTT Broker bilgileri
        var broker = "broker.emqx.io";
        var port = 8083; // MQTT web soketi portu

        // MQTT client oluşturma
        var clientId = "mqttjs_" + Math.random().toString(16).substr(2, 8);
        var client = mqtt.connect('wss://' + broker + ':' + port);

        // Bağlantı başarılı olduğunda çalışacak fonksiyon
        client.on('connect', function () {
            console.log('MQTT Broker\'a başarıyla bağlandı');
        });

        // Bağlantı hatası olduğunda çalışacak fonksiyon
        client.on('error', function (error) {
            console.log('Bağlantı hatası: ' + error.toString());
        });

        // MQTT mesaj gönderme fonksiyonu
        function sendMessage(topic, value) {
            client.publish(topic, value.toString());
        }

        // Slider değerlerini dinleyip MQTT'ye gönderme
        document.addEventListener("DOMContentLoaded", function() {
            var sliders = document.querySelectorAll(".slider");

            sliders.forEach(function(slider) {
                slider.addEventListener("input", function() {
                    var topic;
                    var value = this.value;
                    switch (this.id) {
                        case "slider1":
                            topic = "onBahce1_sure";
                            break;
                        case "slider2":
                            topic = "onBahce2_sure";
                            break;
                        case "slider3":
                            topic = "arkaBahce1_sure";
                            break;
                        case "slider4":
                            topic = "arkaBahce2_sure";
                            break;
                        default:
                            break;
                    }
                    document.getElementById(this.id + "Value").textContent = value;
                    sendMessage(topic, value);
                });
            });
        });
    </script>
</body>
</html>
